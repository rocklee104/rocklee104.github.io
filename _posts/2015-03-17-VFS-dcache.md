---
layout: post
title: Linux VFS dcache分析
published: true
---

在linux的VFS中，dcache(directory entry cache)起了至关重要的作用. 它将部分文件名保存在内存中. 在查找文件名的时候减少了进行磁盘操作. 提高了文件系统的性能. 并且它和对应的文件inode关联起来. 是文件名和对应文件内容的粘合剂. 此外, linux目录树也是通过dcache组织起来的. 本文目前只关注dcache的分配和释放过程. 
## 1.dentry的状态
dcache中的成员就是dentry, 在dcache中存在的dentry分为下面四种状态：

- free

处于该状态的目录项对象不包含有效的信息，还没有被VFS使用。它对应的内存区由slab分配器进行管理.

- unused:
      处于该状态的目录项对象当前还没有被内核使用。该对象的引用计数器d_count的值为0。但其d_inode域仍然指向相关的索引节点。该目录项对象包含有效的信息，但为了在必要时回收内存，它的内容可能被丢弃.
      
- in use:
      处于该状态的目录项对象当前正在被内核使用。该对象的引用计数器d_count的值为正数，而其d_inode域指向相关的索引节点对象。该目录项对象包含有效的信息，并且不能被丢弃.

- negtive:
      与目录项相关的索引节点不复存在，那是因为相应的磁盘索引节点已被删除。该目录项对象的d_inode域置为NULL，但该对象仍然被保存在目录项高速缓存中，以便后续对同一文件目录名的查找操作能够快速完成，术语“负的”容易使人误解，因为根本不涉及任何负值.

